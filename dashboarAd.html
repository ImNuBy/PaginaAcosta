<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="css/dashad.css">
    <title>ğŸ‘” Mi Escuela - Administrador</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
    </style>
</head>
<body>
    <div class="floating-elements">
        <div class="floating-emoji" style="top: 10%; left: 5%; animation-delay: 0s;">ğŸ‘”</div>
        <div class="floating-emoji" style="top: 20%; right: 10%; animation-delay: 1s;">ğŸ“Š</div>
        <div class="floating-emoji" style="top: 60%; left: 15%; animation-delay: 2s;">ğŸ«</div>
        <div class="floating-emoji" style="bottom: 20%; right: 5%; animation-delay: 3s;">ğŸ“ˆ</div>
        <div class="floating-emoji" style="bottom: 40%; left: 8%; animation-delay: 4s;">âš™ï¸</div>
        <div class="floating-emoji" style="top: 40%; right: 20%; animation-delay: 5s;">ğŸ“‹</div>
    </div>

    <div class="header">
        <div class="logo">
            ğŸ¢ <span>Panel Administrativo</span>
        </div>
        <div class="user-info">
            <div class="avatar" id="userAvatar">ğŸ‘”</div>
            <span id="userName">Administrador</span>
            <a href="../php/logout.php" class="logout-btn">Salir ğŸ‘‹</a>
        </div>
    </div>

    <div class="container">
        <div class="welcome-card">
            <h1>Â¡Buen dÃ­a, <span id="welcomeName">Administrador</span>! ğŸŒŸ</h1>
            <p>Â¡Gestionando con excelencia nuestra instituciÃ³n educativa! ğŸ«âœ¨</p>
        </div>

        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-icon">ğŸ‘¥</div>
                <span class="stat-number" id="totalUsers">245</span>
                <div>Total Usuarios</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">ğŸ’</div>
                <span class="stat-number" id="studentsTotal">180</span>
                <div>Estudiantes</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">ğŸ‘¨â€ğŸ«</div>
                <span class="stat-number" id="teachersTotal">25</span>
                <div>Profesores</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">ğŸ“š</div>
                <span class="stat-number" id="coursesTotal">15</span>
                <div>Cursos Activos</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">ğŸ“Š</div>
                <span class="stat-number" id="systemHealth">98%</span>
                <div>Salud del Sistema</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">ğŸ’¬</div>
                <span class="stat-number" id="messagesTotal">1.2K</span>
                <div>Mensajes Hoy</div>
            </div>
        </div>

        <div class="admin-grid">
            <div class="admin-tools">
                <div class="section">
                    <h2 class="section-title">ğŸ› ï¸ GestiÃ³n de Usuarios</h2>
                    <div class="tool-grid">
                        <button class="tool-btn" onclick="createUser()">
                            <span class="icon">â•</span>
                            <span>Crear Usuario</span>
                        </button>
                        <button class="tool-btn" onclick="manageRoles()">
                            <span class="icon">ğŸ‘¤</span>
                            <span>Roles</span>
                        </button>
                        <button class="tool-btn" onclick="viewReports()">
                            <span class="icon">ğŸ“Š</span>
                            <span>Reportes</span>
                        </button>
                        <button class="tool-btn" onclick="bulkActions()">
                            <span class="icon">âš¡</span>
                            <span>Acciones Masivas</span>
                        </button>
                    </div>
                </div>

                <div class="section">
                    <h2 class="section-title">âš™ï¸ ConfiguraciÃ³n Sistema</h2>
                    <div class="tool-grid">
                        <button class="tool-btn" onclick="systemSettings()">
                            <span class="icon">âš™ï¸</span>
                            <span>ConfiguraciÃ³n</span>
                        </button>
                        <button class="tool-btn" onclick="backup()">
                            <span class="icon">ğŸ’¾</span>
                            <span>Backup</span>
                        </button>
                        <button class="tool-btn" onclick="security()">
                            <span class="icon">ğŸ”’</span>
                            <span>Seguridad</span>
                        </button>
                        <button class="tool-btn" onclick="maintenance()">
                            <span class="icon">ğŸ”§</span>
                            <span>Mantenimiento</span>
                        </button>
                    </div>
                </div>

                <div class="section">
                    <h2 class="section-title">ğŸ“ˆ AnÃ¡lisis y EstadÃ­sticas</h2>
                    <div class="tool-grid">
                        <button class="tool-btn" onclick="analytics()">
                            <span class="icon">ğŸ“ˆ</span>
                            <span>Analytics</span>
                        </button>
                        <button class="tool-btn" onclick="performance()">
                            <span class="icon">âš¡</span>
                            <span>Rendimiento</span>
                        </button>
                        <button class="tool-btn" onclick="logs()">
                            <span class="icon">ğŸ“</span>
                            <span>Logs</span>
                        </button>
                        <button class="tool-btn" onclick="monitoring()">
                            <span class="icon">ğŸ‘ï¸</span>
                            <span>Monitoreo</span>
                        </button>
                    </div>
                </div>

                <div class="section">
                    <h2 class="section-title">ğŸ‘¥ Usuarios Recientes</h2>
                    <div class="user-management">
                        <div class="user-item">
                            <div class="user-info">
                                <h4>MarÃ­a GonzÃ¡lez</h4>
                                <p>Estudiante â€¢ Creado hace 2 horas</p>
                            </div>
                            <div class="user-actions">
                                <button class="btn-small">Ver</button>
                                <button class="btn-small btn-warning">Editar</button>
                            </div>
                        </div>
                        <div class="user-item">
                            <div class="user-info">
                                <h4>Prof. RodrÃ­guez</h4>
                                <p>Profesor â€¢ Ãšltimo acceso: hace 1h</p>
                            </div>
                            <div class="user-actions">
                                <button class="btn-small">Ver</button>
                                <button class="btn-small btn-warning">Editar</button>
                            </div>
                        </div>
                        <div class="user-item">
                            <div class="user-info">
                                <h4>Carlos PÃ©rez</h4>
                                <p>Estudiante â€¢ Inactivo 7 dÃ­as</p>
                            </div>
                            <div class="user-actions">
                                <button class="btn-small">Ver</button>
                                <button class="btn-small btn-danger">Suspender</button>
                            </div>
                        </div>
                        <div class="user-item">
                            <div class="user-info">
                                <h4>Ana LÃ³pez</h4>
                                <p>Profesor â€¢ Nuevo usuario</p>
                            </div>
                            <div class="user-actions">
                                <button class="btn-small">Activar</button>
                                <button class="btn-small btn-warning">Configurar</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="chat-section">
                <div class="chat-header">
                    <h3 class="section-title">ğŸ’¬ Chat Administrativo</h3>
                    <div class="role-filter">
                        <button class="filter-btn active" data-filter="todos">Todos</button>
                        <button class="filter-btn" data-filter="admin">Admins</button>
                        <button class="filter-btn" data-filter="profesor">Profesores</button>
                        <button class="filter-btn" data-filter="estudiante">Estudiantes</button>
                    </div>
                </div>
                <div class="chat-messages" id="chatMessages">
                    <!-- Los mensajes se cargarÃ¡n aquÃ­ -->
                </div>
                <div class="chat-input">
                    <input type="text" id="messageInput" placeholder="Mensaje administrativo...">
                    <button class="send-btn" onclick="sendMessage()">Enviar</button>
                </div>
            </div>
        </div>

        <div class="system-alerts">
            <h2 class="section-title">ğŸš¨ Alertas del Sistema</h2>
            <div class="alert-item">
                <strong>ğŸ”´ CrÃ­tico:</strong> Espacio en disco bajo (15% disponible)
            </div>
            <div class="alert-item warning">
                <strong>ğŸŸ¡ Advertencia:</strong> 3 usuarios intentos de login fallidos
            </div>
            <div class="alert-item success">
                <strong>ğŸŸ¢ Ã‰xito:</strong> Backup automÃ¡tico completado exitosamente
            </div>
            <div class="alert-item info">
                <strong>ğŸ”µ Info:</strong> ActualizaciÃ³n del sistema programada para este fin de semana
            </div>
        </div>
    </div>

    <script>
        class AdminDashboard {
            constructor() {
                this.currentFilter = 'todos';
                this.messages = [];
                this.user = JSON.parse(localStorage.getItem('user') || '{}');
                this.init();
            }

            init() {
                this.loadUserInfo();
                this.setupEventListeners();
                this.loadMessages();
                this.startMessagePolling();
                this.loadStats();
                this.startSystemMonitoring();
            }

            loadUserInfo() {
                if (this.user.nombre_completo) {
                    document.getElementById('userName').textContent = this.user.nombre_completo;
                    document.getElementById('welcomeName').textContent = this.user.nombre_completo;
                }

                if (this.user.avatar_color) {
                    const avatar = document.getElementById('userAvatar');
                    avatar.style.backgroundColor = this.user.avatar_color;
                    avatar.textContent = this.user.nombre_completo ? this.user.nombre_completo[0].toUpperCase() : 'ğŸ‘”';
                }
            }

            setupEventListeners() {
                document.querySelectorAll('.filter-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                        e.target.classList.add('active');
                        this.currentFilter = e.target.dataset.filter;
                        this.filterMessages();
                    });
                });

                document.getElementById('messageInput').addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        this.sendMessage();
                    }
                });
            }

            async loadMessages() {
                try {
                    const response = await fetch('../api/chat/messages.php');
                    const data = await response.json();
                    
                    if (data.success) {
                        this.messages = data.messages;
                        this.renderMessages();
                    }
                } catch (error) {
                    // Mensajes de demo para administradores
                    this.messages = [
                        {
                            id: 1,
                            autor: 'Sistema',
                            rol: 'admin',
                            mensaje: 'ğŸ”§ Mantenimiento programado completado exitosamente',
                            timestamp: new Date(Date.now() - 10800000)
                        },
                        {
                            id: 2,
                            autor: 'Prof. GarcÃ­a',
                            rol: 'profesor',
                            mensaje: 'Solicito acceso al mÃ³dulo de reportes avanzados ğŸ“Š',
                            timestamp: new Date(Date.now() - 5400000)
                        },
                        {
                            id: 3,
                            autor: 'MarÃ­a Estudiante',
                            rol: 'estudiante',
                            mensaje: 'Â¿CÃ³mo puedo recuperar mi contraseÃ±a? ğŸ”‘',
                            timestamp: new Date(Date.now() - 3600000)
                        },
                        {
                            id: 4,
                            autor: 'Admin LÃ³pez',
                            rol: 'admin',
                            mensaje: 'Nuevas polÃ­ticas de seguridad implementadas ğŸ”’',
                            timestamp: new Date(Date.now() - 1800000)
                        }
                    ];
                    this.renderMessages();
                }
            }

            renderMessages() {
                const chatMessages = document.getElementById('chatMessages');
                const filteredMessages = this.messages.filter(msg => 
                    this.currentFilter === 'todos' || msg.rol === this.currentFilter
                );

                chatMessages.innerHTML = filteredMessages.map(msg => `
                    <div class="message">
                        <div class="message-header">
                            <span class="message-author">${msg.autor}</span>
                            <span class="message-role">${this.getRoleEmoji(msg.rol)} ${msg.rol}</span>
                            <span class="message-time">${this.formatTime(msg.timestamp)}</span>
                        </div>
                        <div class="message-content">${msg.mensaje}</div>
                    </div>
                `).join('');

                chatMessages.scrollTop = chatMessages.scrollHeight;
            }

            filterMessages() {
                this.renderMessages();
            }

            async sendMessage() {
                const input = document.getElementById('messageInput');
                const mensaje = input.value.trim();

                if (!mensaje) return;

                const newMessage = {
                    id: Date.now(),
                    autor: this.user.nombre_completo || this.user.username,
                    rol: this.user.rol,
                    mensaje: mensaje,
                    timestamp: new Date()
                };

                try {
                    const response = await fetch('../api/chat/send.php', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(newMessage)
                    });

                    if (response.ok) {
                        this.messages.push(newMessage);
                        this.renderMessages();
                        input.value = '';
                    }
                } catch (error) {
                    this.messages.push(newMessage);
                    this.renderMessages();
                    input.value = '';
                }
            }

            startMessagePolling() {
                setInterval(() => {
                    this.loadMessages();
                }, 5000);
            }

            loadStats() {
                // Simular carga de estadÃ­sticas administrativas
                setTimeout(() => {
                    document.getElementById('totalUsers').textContent = Math.floor(Math.random() * 50) + 200;
                    document.getElementById('studentsTotal').textContent = Math.floor(Math.random() * 30) + 150;
                    document.getElementById('teachersTotal').textContent = Math.floor(Math.random() * 10) + 20;
                    document.getElementById('coursesTotal').textContent = Math.floor(Math.random() * 5) + 12;
                    document.getElementById('systemHealth').textContent = (95 + Math.random() * 5).toFixed(1) + '%';
                    document.getElementById('messagesTotal').textContent = (Math.random() * 0.8 + 1.0).toFixed(1) + 'K';
                }, 1000);
            }

            startSystemMonitoring() {
                // Simular monitoreo del sistema
                setInterval(() => {
                    const health = (95 + Math.random() * 5).toFixed(1);
                    document.getElementById('systemHealth').textContent = health + '%';
                }, 30000);
            }

            getRoleEmoji(rol) {
                const emojis = {
                    'estudiante': 'ğŸ’',
                    'profesor': 'ğŸ‘¨â€ğŸ«',
                    'admin': 'ğŸ‘”'
                };
                return emojis[rol] || 'ğŸ‘¤';
            }

            formatTime(timestamp) {
                const date = new Date(timestamp);
                const now = new Date();
                const diff = now - date;

                if (diff < 60000) return 'ahora';
                if (diff < 3600000) return `${Math.floor(diff / 60000)}m`;
                if (diff < 86400000) return `${Math.floor(diff / 3600000)}h`;
                return date.toLocaleDateString();
            }
        }

        // Funciones especÃ­ficas del administrador
        function createUser() {
            alert('â• Creador de usuarios - Â¡En desarrollo!');
        }

        function manageRoles() {
            alert('ğŸ‘¤ Gestor de roles y permisos - Â¡PrÃ³ximamente!');
        }

        function viewReports() {
            alert('ğŸ“Š Sistema de reportes avanzados - Â¡En desarrollo!');
        }

        function bulkActions() {
            alert('âš¡ Acciones masivas - Â¡PrÃ³ximamente!');
        }

        function systemSettings() {
            alert('âš™ï¸ ConfiguraciÃ³n del sistema - Â¡En desarrollo!');
        }

        function backup() {
            alert('ğŸ’¾ Sistema de backup - Â¡PrÃ³ximamente!');
        }

        function security() {
            alert('ğŸ”’ Panel de seguridad - Â¡En desarrollo!');
        }

        function maintenance() {
            alert('ğŸ”§ Modo mantenimiento - Â¡PrÃ³ximamente!');
        }

        function analytics() {
            alert('ğŸ“ˆ Analytics avanzados - Â¡En desarrollo!');
        }

        function performance() {
            alert('âš¡ Monitor de rendimiento - Â¡PrÃ³ximamente!');
        }

        function logs() {
            alert('ğŸ“ Visor de logs del sistema - Â¡En desarrollo!');
        }

        function monitoring() {
            alert('ğŸ‘ï¸ Monitoreo en tiempo real - Â¡PrÃ³ximamente!');
        }

        function sendMessage() {
            window.dashboard.sendMessage();
        }

        // Inicializar dashboard
        document.addEventListener('DOMContentLoaded', () => {
            window.dashboard = new AdminDashboard();
        });
    </script>
</body>
</html>
